services:
  aide:
    build:
      context: .
    image: outstand/aide:dev
    working_dir: ${WORKSPACE_DIR}
    volumes:
      - bundler-data:/usr/local/bundle
      - .:${WORKSPACE_DIR}
    ports:
      - "3000"
    environment:
      FIXUID:
      FIXGID:
      WORKSPACE_DIR:

  release_gem:
    image: outstand/aide:dev
    command: rake release
    working_dir: ${WORKSPACE_DIR}
    environment:
      FIXUID:
      FIXGID:
      WORKSPACE_DIR:
    volumes:
      - bundler-data:/usr/local/bundle
      - .:${WORKSPACE_DIR}
      - ~/.dotfiles/config/git/gitconfig:/home/deploy/.gitconfig
      - ~/.dotfiles/config/git/gitconfig.user:/home/deploy/.gitconfig.user
      - ~/.ssh/id_rsa:/home/deploy/.ssh/id_rsa
      - ~/.gem:/home/deploy/.gem

volumes:
  bundler-data:
